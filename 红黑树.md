# 红黑树

### 平衡性质

红黑树是__自平衡二叉树__，满足平衡二叉树的所有性质。

红黑树通过在插入删除操作过程中维护原有性质来保持二叉树的平衡。

### 数据结构

是一种树，由于存在节点的旋转，最适合使用链表来实现，而不是线性表。

每个节点应该保存有，数据字段，红黑颜色属性，父节点指针，子节点指针。

### 红黑树特性

- __节点是红色或黑色。__
- __根节点是黑色。__
- __每个红色节点的两个子节点都是黑色。(从每个叶子到根的所有路径上不能有两个连续的红色节点)__
- __从任一节点到其每个叶子的所有路径都包含相同数目的黑色节点。__

由上面可以推出两个规律

- 如果一个结点存在黑子结点，那么该结点肯定有两个子结点
- 叶子节点（NIL）是黑色的。

从约束可以想到，所有的红黑树，剔除红色节点，那么所有的叶子节点深度相同，也就是完全平衡。那么在一个叶子节点的路径上，添加上最多的红节点，最多插入的红色节点数，和黑色节点数相同。这就是红黑树最差的情况，可以计算到，其长度近似为`2log n`，和最短的叶子节点路径相差`log n`，那么查询时间的最坏情况是$O(log n)$，由此可见，查询方面，红黑树性能优于普通的二叉查找树，和AVL树接近。

可以看到有的画图中，看起来不满足性质，例如，某个红色节点，只有一个子节点是黑色，另外一个没画出来，那么确实这是省略了空叶子节点，其一定是黑色。在省略的情况下，不会影响到红黑树性质的保持。

### 插入操作

__红黑树每次插入节点一定是红色节点__。

插入过程中有三种操作：

- 变色

当前节点为红色，父节点也是红色，叔父节点红色或者不存在。 （叔父节点为黑色是可以但是不可以如此操作）

将父节点和叔父节点变黑色（如果叔父存在），将祖父节点变红色。可以发现，由祖父节点为根节点的子树达到了红黑树的性质。但是整棵树不一定达到，所以，然后其关注点转移至祖父节点。

- 左旋

当前节点的父节点是红色，叔叔节点存在且是黑色。当前节点是右子树。

其左旋操作和AVL树中的是一致的。

- 右旋

当前节点的父节点是红色，叔叔节点存在且是黑色。当前节点是右左子树。

也是一致的。

下面的是所有的插入情形：

<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:525px; height:245px;" src="https://www.processon.com/embed/5e55eb53e4b0cb56daa92dda"></iframe>
下面展示一个插入过程，图片可以放大查看。

<iframe id="embed_dom" name="embed_dom" frameborder="0" style="display:block;width:525px; height:245px;" src="https://www.processon.com/embed/5e55d14ee4b069f82a120c87"></iframe>
上述插入操作，涉及到第4.1情形，得到第4.2.2情形，转化为第4.2.1情形，最终平衡维护成功。

#### 操作分析

情形1，2，3都是很好理解的，情形4需要着重分析，叔父节点的的存在和颜色为何会成为条件？这是因为叔父节点如果是黑色，那么不会约束到祖父节点的变色，可以变色后进行旋转，如果叔父是红色，那么就需要父亲祖父叔父全部一起变色。